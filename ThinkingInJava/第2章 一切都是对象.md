# 第2章 一切都是对象





## 1. 用引用操作对象

java语言假设我们只进行面向对象的程序设计。java中，一切都被视为对象，因此可采用单一固定的语法来操纵内存中的元素。尽管一切都看做对象，但是操纵的标识符实际上是对象的一个引用（reference）。可以将这一情形想象成使用遥控器（引用）来控制电视机（对象），实际操控的是遥控器（引用），再通过遥控器来调控电视机（对象）；此外即使没有电视机，遥控器也可以独立的存在，即拥有一个引用并不一定需要有一个对象与他相关联。对没有相关联的引用进行操作会引起一个运行时异常，所以一种安全的做法是创建一个引用的同时就对这个引用进行初始化。一旦创建了一个引用，就夕阳它能够与一个新的对象相关联。



## 2. 必须由你创建创建所有对象

通常使用new操作符来实现这一目的。new关键字的意思是“给我创建一个对象”

### 2.1 储存到什么地方

在程序运行的时候，有五个地方可以存储数据：

1. 寄存器。这是最快的存储区，因为他位于不同于其他存储的区域——处理器内部。但是寄存器的数量及其有限，所以寄存去根据需求进行分配，不能由程序员直接控制。
2. 堆栈（栈）。位于通用RAM中，这是一种快速有效的分配存储方法，仅次于寄存器。java中对象指针存储在堆栈中。创建程序时，java系统必须知道存储在堆栈内所有项的确切生命周期，以便上下移动堆栈指针，这一约束限制了程序的灵活性。
3. 堆。是一种通用的内存池（也位于RAM中），用于存放所有的java对象。堆不同于堆栈的好处是：编译器不需要知道存储的数据在堆里存活多长时间。因此，在堆中分配的内存有极大的灵活性。当需要一个对象的时候，只需要使用new语句。当执行这一行代码的时候，会自动在堆中进行存储分配。但是这种灵活性的代价就是：在堆内存中进行存储分配与清理会比堆栈中进行存储分配需要更多的时间。
4. 常量存储。常量值通常直接存放在程序代码内部。这样由于常量永远不会被改变，所以是安全的。
5. 非RAM存储。如果数据完全存活于程序之外，那么它可以不受程序的任何控制。在程序没有运行时也可以存在。其中两个基本的例子就是流对象与持久化对象。

其中有个特例时基本类型，由于各种基本类型比较简单，使用new来在堆中创建对象不是很高效。所以这些变量不适用new来创建对象，而是创建一个并非时引用的“自动”变量。这个变量直接存储“值”，并放置于栈内存中，因此更加高效。

Java要确定没重笔本类型所占存储空间的大小，把门的大小并不像其他大多数语言那样随着机器硬件架构的变化而变化。这种所占存储空间大小的不变性时java程序比其他语言更具备可移植性的原因之一。所有的数值类型都有正负号，不存在无符号的数值。

另外java提供两个用于高精度计算的类：BigInteger与BigDecimal。

java由于考虑到安全性，所以在创建一个数组的时候，会确保初始化，并且不能在数组的范围之外进行访问。当创建一个数组对象时，实际上就是创建了一个引用数组，并且每个引用都会自动被初始化为一个特定的值null。在使用任何引用之前，必须为其指定一个对象，如果试图使用一个还是null的引用，那么在运行时将会报错。同样的，也可以创建存放基本类型的数组，编译器也能够确保这种数组的初始化，因为它会将这种数组所占的内存全部置零。



## 3. 永远不要销毁对象

### 3.1 作用域

​	java中作用域（scope）由花括号的位置决定。在作用域里定义的变量只可以用于作用域结束之前。java中不允许较小作用域的变量将一个较大作用域的变量“隐藏起来”。例如：

```java
{
  int x = 4;
  {
    int x = 9; // illegal
  }
}
```

### 3.2 对象的作用域

​	java中对象不具备和基本类型一样的生命周期。当使用new语句来创建一个对象的时候，他可以存活于作用域之外。所以当有以下语句的时候：

```java
{
  String s = new String("gakki");
  // end of scope
}
```

引用s在作用域终点就消失了，然而s这个引用所指向的对象任然占据着内存空间。在这段代码之后，就无法访问这个字符串对象了，因为这个对象唯一的一个引用已经超出了作用域的范围。java中有一个垃圾回收器，用来监视使用new创建的所有的对象，并辨别那些不再被引用的对象，随后，释放这些对象的内存资源，以供其他新的内存对象所使用。所以就不必再去关心内存的回收，程序员只需要创建对象，一旦对象不再需要，他们就会自行消失。



## 4. 创建新的数据类型：类

使用class关键字可以创建一个新的类型。

### 4.1 字段与方法

一旦定义了一个类，那么就可以在类中设定两种类型的元素：

1. 字段（数据成员）。字段可以是任何类型的变量，也可以是基本类型的一种。如果字段是某个类型的引用，那么必须初始化此引用，以便使其与一个实际的对象相关联。
2. 方法（成员函数）。

若**类的某个成员**是基本数据类型，那么即使没有初始化，java也会确保它获得一个默认值。然而对于某个局部变量，则不会有默认值，所以在局部变量未初始化就使用的时候，java会在编译时就返回一个错误。



## 5. 方法、参数与返回值

Java的方法决定了一个对象能够接收什么样的信息。方法的基本组成部分包括名称、参数、返回值与方法体。方法名与参数列表合称方法签名，他们唯一的标识出某个方法。























参考链接：